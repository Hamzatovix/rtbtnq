# üìä –û—Ç—á–µ—Ç –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ (–í–µ—Ä—Å–∏—è 2)

## ‚úÖ –£–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ

### 1. Next.js –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ‚úÖ
- –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (AVIF, WebP)
- –ö–æ–º–ø—Ä–µ—Å—Å–∏—è –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–±–æ—Ä–∫–∏
- Webpack fallbacks –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

### 2. –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ API routes ‚úÖ
- `/api/products` - –∫–µ—à 60 —Å–µ–∫—É–Ω–¥ (ISR)
- `/api/categories` - –∫–µ—à 1 —á–∞—Å
- `/api/colors` - –∫–µ—à 1 —á–∞—Å
- –ó–∞–≥–æ–ª–æ–≤–∫–∏ `Cache-Control` –¥–æ–±–∞–≤–ª–µ–Ω—ã

### 3. –ö–µ—à –≤ –ø–∞–º—è—Ç–∏ –¥–ª—è orders ‚úÖ
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ 5 —Å–µ–∫—É–Ω–¥
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–ø–∏—Å–∏

### 4. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ Telegram ‚úÖ
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `setImmediate` –¥–ª—è –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–µ–π –æ—Ç–ø—Ä–∞–≤–∫–∏

### 5. –ú–µ–º–æ–∏–∑–∞—Ü–∏—è Zustand stores ‚úÖ
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è `getTotalPrice()` –∏ `getTotalItems()`
- –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 6. React.memo –¥–ª—è ProductCard ‚úÖ
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –æ–±–µ—Ä–Ω—É—Ç –≤ `memo` —Å –∫–∞—Å—Ç–æ–º–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–µ–π —Å—Ä–∞–≤–Ω–µ–Ω–∏—è

---

## üö® –ù–û–í–´–ï –ü–†–û–ë–õ–ï–ú–´ –î–õ–Ø –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò

### 1. **–ö—Ä–∏—Ç–∏—á–Ω–æ: –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã –æ—Ç–∫–ª—é—á–∞—é—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ**

**–ü—Ä–æ–±–ª–µ–º–∞:** –í—Å–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `cache: 'no-store'`, —á—Ç–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–ª—é—á–∞–µ—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞.

**–ì–¥–µ –Ω–∞–π–¥–µ–Ω–æ:**
- `front/src/lib/hooks.ts` (—Å—Ç—Ä–æ–∫–∏ 117-119, 31, 75)
- `front/src/app/product/[id]/page.tsx` (—Å—Ç—Ä–æ–∫–∏ 64-65)
- `front/src/app/backoffice/**/*.tsx` (–º–Ω–æ–∂–µ—Å—Ç–≤–æ –º–µ—Å—Ç)

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// –í–º–µ—Å—Ç–æ cache: 'no-store'
fetch('/api/products') // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–µ—à –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

// –ò–ª–∏ –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö —Å –∫–æ—Ä–æ—Ç–∫–∏–º TTL
fetch('/api/products', { 
  next: { revalidate: 60 } 
})

// –î–ª—è backoffice (–≥–¥–µ –Ω—É–∂–Ω—ã —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ)
fetch('/api/products', { 
  cache: 'no-store' 
}) // –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∫–∏
```

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** 70-90% –º–µ–Ω—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ

---

### 2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤**

**–ü—Ä–æ–±–ª–µ–º–∞:** `/api/products/[id]/route.ts` –Ω–µ –∏–º–µ–µ—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è, –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å —á–∏—Ç–∞–µ—Ç —Ñ–∞–π–ª —Å –¥–∏—Å–∫–∞.

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// front/src/app/api/products/[id]/route.ts
export const revalidate = 60 // ISR: –æ–±–Ω–æ–≤–ª—è—Ç—å –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥

export async function GET(...) {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
  return NextResponse.json({ ...product, id: String(product.id) }, {
    headers: {
      'Cache-Control': 'public, s-maxage=60, stale-while-revalidate=300'
    }
  })
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** 80% –±—ã—Å—Ç—Ä–µ–µ –∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü —Ç–æ–≤–∞—Ä–æ–≤

---

### 3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–µ—à–∞ –¥–ª—è —á—Ç–µ–Ω–∏—è JSON —Ñ–∞–π–ª–æ–≤**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –∫ `/api/products`, `/api/categories` —á–∏—Ç–∞–µ—Ç —Ñ–∞–π–ª —Å –¥–∏—Å–∫–∞.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –∫–µ—à –≤ –ø–∞–º—è—Ç–∏ (–∫–∞–∫ –¥–ª—è orders):
```typescript
// front/src/server/products/products-json.service.ts (—Å–æ–∑–¥–∞—Ç—å)
let productsCache: any[] | null = null
let cacheTimestamp = 0
const CACHE_TTL = 5000 // 5 —Å–µ–∫—É–Ω–¥

export async function loadProducts(): Promise<any[]> {
  const now = Date.now()
  if (productsCache && (now - cacheTimestamp) < CACHE_TTL) {
    return productsCache
  }
  
  const filePath = await getProductsPath()
  const content = await readFile(filePath, 'utf-8')
  const data = JSON.parse(content)
  productsCache = Array.isArray(data) ? data : (data?.results ?? [])
  cacheTimestamp = now
  return productsCache
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** 90% –±—ã—Å—Ç—Ä–µ–µ —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

---

### 4. **CartDrawer –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±—ã—á–Ω—ã–π `<img>`**

**–ü—Ä–æ–±–ª–µ–º–∞:** `front/src/components/cart/cart-drawer.tsx` (—Å—Ç—Ä–æ–∫–∞ 95) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `<img>` –≤–º–µ—Å—Ç–æ `OptimizedImage`.

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
import { OptimizedImage } from '@/components/ui/optimized-image'

// –ó–∞–º–µ–Ω–∏—Ç—å <img> –Ω–∞:
<OptimizedImage
  src={item.image.startsWith('http') || item.image.startsWith('/') ? item.image : `/${item.image}`}
  alt={item.title}
  width={64}
  height={64}
  className="w-full h-full object-cover"
/>
```

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** –õ—É—á—à–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π WebP/AVIF

---

### 5. **–ù–µ—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ —Ü–≤–µ—Ç–æ–≤**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Ü–≤–µ—Ç–∞ —á–∏—Ç–∞—é—Ç—Å—è –∏–∑ —Ñ–∞–π–ª–∞ –∫–∞–∂–¥—ã–π —Ä–∞–∑.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –∫–µ—à –≤ –ø–∞–º—è—Ç–∏ (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ products):
```typescript
// front/src/server/categories/categories-json.service.ts
// front/src/server/colors/colors-json.service.ts
```

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** 90% –±—ã—Å—Ç—Ä–µ–µ –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤

---

### 6. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ SWR/React Query –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ.

**–†–µ—à–µ–Ω–∏–µ:** –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å SWR:
```typescript
// front/src/lib/hooks.ts
import useSWR from 'swr'

const fetcher = (url: string) => fetch(url).then(r => r.json())

export function useProducts(filters) {
  const key = `/api/products?${new URLSearchParams(filters)}`
  const { data, error, isLoading } = useSWR(key, fetcher, {
    revalidateOnFocus: false,
    revalidateOnReconnect: false,
    dedupingInterval: 60000, // 1 –º–∏–Ω—É—Ç–∞
  })
  // ...
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ, –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤, –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

---

### 7. **–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å React.memo –¥–ª—è –¥—Ä—É–≥–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤**

**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –∫–∞–Ω–¥–∏–¥–∞—Ç—ã:**
- `CartDrawer` - —á–∞—Å—Ç–æ —Ä–µ-—Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è
- `FeaturedProducts` - —Å—Ç–∞—Ç–∏—á–Ω—ã–π —Å–ø–∏—Å–æ–∫
- –§–∏–ª—å—Ç—Ä—ã –≤ –∫–∞—Ç–∞–ª–æ–≥–µ

---

## üìä –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ö—Ä–∏—Ç–∏—á–Ω–æ - –≤—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞)
1. ‚úÖ –£–±—Ä–∞—Ç—å `cache: 'no-store'` –∏–∑ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (–∫—Ä–æ–º–µ backoffice)
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∫–µ—à –≤ –ø–∞–º—è—Ç–∏ –¥–ª—è products/categories/colors
3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è `/api/products/[id]`

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–í–∞–∂–Ω–æ - —É–ª—É—á—à–µ–Ω–∏–µ UX)
4. ‚úÖ –ó–∞–º–µ–Ω–∏—Ç—å `<img>` –Ω–∞ `OptimizedImage` –≤ CartDrawer
5. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å SWR –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
6. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å React.memo –¥–ª—è –¥—Ä—É–≥–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
7. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—é –¥–ª—è –±–æ–ª—å—à–∏—Ö —Å–ø–∏—Å–∫–æ–≤ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

---

## üìà –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –ø–æ—Å–ª–µ –≤—Å–µ—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π

| –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è | –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ |
|------------|------------------------------|
| –£–±—Ä–∞—Ç—å cache: 'no-store' | 70-90% –º–µ–Ω—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ |
| –ö–µ—à –≤ –ø–∞–º—è—Ç–∏ –¥–ª—è JSON | 90% –±—ã—Å—Ç—Ä–µ–µ —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ |
| –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ /products/[id] | 80% –±—ã—Å—Ç—Ä–µ–µ –∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü |
| OptimizedImage –≤ CartDrawer | 30-50% –º–µ–Ω—å—à–µ —Ä–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π |
| SWR –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | 60-80% –º–µ–Ω—å—à–µ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ |

**–û–±—â–µ–µ –æ–∂–∏–¥–∞–µ–º–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ:** 50-70% —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

---

## üîß –°—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ: 6/6 –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π
- ‚è≥ –û—Å—Ç–∞–ª–æ—Å—å: 7 –Ω–æ–≤—ã—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π
- üìÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å—Ä–æ–∫: 2-3 –¥–Ω—è

---

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
   - –î–æ–±–∞–≤–∏—Ç—å Web Vitals –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ
   - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (>1s)

2. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:**
   - –î–æ–±–∞–≤–∏—Ç—å blur placeholder –¥–ª—è –≤—Å–µ—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å–æ–≥–ª–∞—Å–Ω–æ `sizes` prop

3. **Bundle –∞–Ω–∞–ª–∏–∑:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä –±–∞–Ω–¥–ª–æ–≤ —Å `@next/bundle-analyzer`
   - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–º–ø–æ—Ä—Ç—ã —Ç—è–∂–µ–ª—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫

4. **Database:**
   - –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ Prisma (—É–∂–µ –ø–æ–¥–∫–ª—é—á–µ–Ω) –≤–º–µ—Å—Ç–æ JSON —Ñ–∞–π–ª–æ–≤
   - –≠—Ç–æ —É–ª—É—á—à–∏—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞ 10-100x

---

*–û—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω: ${new Date().toLocaleString('ru-RU')}*
*–ü–æ—Å–ª–µ–¥–Ω–∏–π –∞–Ω–∞–ª–∏–∑: –ø–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –ø–µ—Ä–≤—ã—Ö 6 –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π*

