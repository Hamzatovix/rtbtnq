@tailwind base;
@tailwind components;
@tailwind utilities;

/* Modern No. 20 Font Face */
@font-face {
  font-family: 'Modern No. 20';
  src: url('/fonts/Modern No. 20.ttf') format('truetype'),
       url('/fonts/Modern%20No.%2020.ttf') format('truetype');
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}

@layer base {
  :root {
    /* Fintage палитра согласно дизайн-документу */
    --background: 0 0% 96%;          /* Off-White #F5F5F3 */
    --foreground: 0 0% 6%;           /* Charcoal Black #0F0F0F */
    --card: 0 0% 98%;                /* Off-White светлее */
    --card-foreground: 0 0% 6%;
    --popover: 0 0% 98%;
    --popover-foreground: 0 0% 6%;
    --primary: 0 0% 6%;              /* Charcoal Black - основной акцент */
    --primary-foreground: 0 0% 96%;
    --secondary: 0 0% 16%;          /* Soft Graphite #2A2A2A */
    --secondary-foreground: 0 0% 96%;
    --muted: 0 0% 92%;
    --muted-foreground: 0 0% 35%;    /* Улучшенная контрастность для читаемости */
    --accent: 180 8% 45%;            /* Sage Slate #6B7F7F - сбалансированный технический акцент с природным оттенком */
    --accent-foreground: 0 0% 96%;   /* Off-White для контраста на sage-slate */
    --destructive: 0 75% 55%;        /* Electric Punch #E63946 */
    --destructive-foreground: 0 0% 96%;
    --border: 0 0% 80%;              /* Более заметная граница для лучшей читаемости */
    --input: 0 0% 98%;
    --ring: 180 8% 45%;              /* Sage Slate focus - сбалансированный технический акцент */
    --radius: 0.125rem;              /* 2px - минимальное скругление */
    
    /* Семантические токены согласно дизайн-системе */
    --color-bg: 0 0% 96%;             /* Off-White #F5F5F3 - основной фон страницы */
    --color-surface: 0 0% 100%;       /* #FFFFFF - поверхность карточек, панелей */
    --color-surface-alt: 0 0% 98%;   /* #FAFAF8 - альтернативная поверхность */
    --color-text-primary: 0 0% 6%;    /* Charcoal Black #0F0F0F - основной текст */
    --color-text-muted: 0 0% 42%;     /* #6B6B6B - приглушённый текст */
    --color-border-subtle: 0 0% 88%;  /* #E0E0E0 - тонкие границы, разделители */
    --color-accent: 180 8% 45%;       /* Sage Slate #6B7F7F - сбалансированный технический акцент с природным оттенком */
    --color-accent-strong: 0 75% 55%; /* Electric Punch #E63946 - сильный акцент */
    --color-danger: 0 75% 55%;         /* Electric Punch - ошибки, предупреждения */
    
    /* Токены для состояний взаимодействия (hover/focus/selection) */
    --color-hover-bg: 180 8% 96%;      /* #F5F6F6 - легкий sage-slate оттенок для hover фона */
    --color-hover-border: 180 8% 60%;  /* #8A9B9B - sage-slate для hover границ */
    --color-active-bg: 180 8% 94%;     /* #E8EAEA - более заметный sage-slate для active */
    --color-active-border: 180 8% 55%; /* #7A8B8B - затемненный sage-slate для active */
    --color-focus-ring: 180 8% 45%;   /* #6B7F7F - основной sage-slate для focus ring */
    --color-selection-bg: 180 8% 88%; /* #D4D8D8 - читаемый sage-slate для выделения текста */
    --color-selection-text: 0 0% 6%;  /* Charcoal Black - контрастный текст на selection */
    
    /* Font variables - используем оригинальные шрифты */
    /* Примечание: --font-body и --font-cormorant устанавливаются в layout.tsx через next/font */
    --font-display: var(--font-cormorant);
    --font-vintage: var(--font-cormorant);
    --font-logo: 'Modern No. 20'; /* Шрифт для логотипа */
    
    /* Fintage цвета бренда */
    --fintage-charcoal: 0 0% 6%;     /* #0F0F0F - Charcoal Black */
    --fintage-graphite: 0 0% 16%;    /* #2A2A2A - Soft Graphite */
    --fintage-offwhite: 0 0% 96%;    /* #F5F5F3 - Off-White */
    --fintage-greige: 180 8% 45%;    /* Sage Slate #6B7F7F - сбалансированный технический акцент с природным оттенком */
    --fintage-steel: 180 8% 45%;     /* Sage Slate - сбалансированный технический акцент */
    --fintage-punch: 0 75% 55%;      /* #E63946 - Electric Punch */
    
    /* Совместимость - старый sand теперь sage-slate */
    --fintage-sand: 180 8% 45%;      /* Sage Slate вместо Accent Sand */
    
    /* Токены отступов согласно дизайн-документу */
    --space-xs: 0.5rem;              /* 8px */
    --space-sm: 1rem;                /* 16px */
    --space-md: 2rem;                /* 32px */
    --space-lg: 3rem;                /* 48px */
    --space-xl: 4rem;                /* 64px */
    
    /* Токены прозрачности согласно дизайн-документу */
    --opacity-low: 0.2;
    --opacity-mid: 0.5;
    --opacity-high: 0.8;
    
    /* Старые переменные для совместимости */
    --vintage-cream: 0 0% 96%;
    --vintage-beige: 0 0% 85%;
    --vintage-black: 0 0% 6%;
    --vintage-gray: 0 0% 40%;
    --vintage-gold: 38 30% 75%;
    --vintage-brown: 0 0% 16%;
    
    /* Fintage тени - минимальные, но выразительные */
    --fintage-shadow-sm: 0 1px 3px rgba(15, 15, 15, 0.12), 0 1px 2px rgba(15, 15, 15, 0.08);
    --fintage-shadow-md: 0 2px 8px rgba(15, 15, 15, 0.15), 0 1px 3px rgba(15, 15, 15, 0.1);
    --fintage-shadow-elevated: 0 4px 16px rgba(15, 15, 15, 0.12), 0 2px 4px rgba(15, 15, 15, 0.08);
    
    /* Винтажные тени (совместимость) */
    --vintage-shadow-sm: var(--fintage-shadow-sm);
    --vintage-shadow-md: var(--fintage-shadow-md);
    --vintage-shadow-lg: var(--fintage-shadow-md);
    --vintage-shadow-vintage: var(--fintage-shadow-md);
    
    /* Старые переменные для совместимости */
    --roseBeige: 45 20% 97%;
    --mistGray: 30 8% 80%;
    --linenWhite: 45 15% 99%;
    --sageTint: 0 0% 8%;
    --inkSoft: 0 0% 8%;
    --soft-shadow: var(--vintage-shadow-sm);
    --medium-shadow: var(--vintage-shadow-md);
    --warm-shadow: var(--vintage-shadow-vintage);
    --breathing-shadow: var(--vintage-shadow-md);
  }

  /* Dark Mode - Fintage темная тема */
  .dark {
    --background: 0 0% 6%;           /* Charcoal Black */
    --foreground: 0 0% 96%;          /* Off-White */
    --card: 0 0% 10%;                /* Dark Card */
    --card-foreground: 0 0% 96%;
    --popover: 0 0% 10%;
    --popover-foreground: 0 0% 96%;
    --primary: 0 0% 96%;             /* Off-White акцент */
    --primary-foreground: 0 0% 6%;
    --secondary: 0 0% 16%;          /* Soft Graphite */
    --secondary-foreground: 0 0% 96%;
    --muted: 0 0% 16%;
    --muted-foreground: 0 0% 65%;    /* Улучшенная контрастность для темной темы */
    --accent: 210 12% 55%;           /* Slate-Blue #6B7F8F - urban vintage акцент (Nike/North Face/Stone Island) */
    --accent-foreground: 0 0% 96%;   /* Off-White для контраста на slate-blue */
    --destructive: 0 75% 55%;        /* Electric Punch */
    --destructive-foreground: 0 0% 96%;
    --border: 0 0% 20%;
    --input: 0 0% 10%;
    --ring: 210 12% 55%;             /* Slate-Blue focus - urban технический акцент */
    
    /* Семантические токены для темной темы */
    --color-bg: 0 0% 6%;              /* Charcoal Black #0F0F0F - основной фон */
    --color-surface: 0 0% 10%;       /* #1A1A1A - поверхность карточек */
    --color-surface-alt: 0 0% 15%;    /* #242424 - альтернативная поверхность */
    --color-text-primary: 0 0% 96%;   /* Off-White #F5F5F3 - основной текст */
    --color-text-muted: 0 0% 69%;     /* #B0B0B0 - приглушённый текст */
    --color-border-subtle: 0 0% 20%;  /* #333333 - тонкие границы */
    --color-accent: 210 12% 55%;      /* Slate-Blue #6B7F8F - urban vintage акцент */
    --color-accent-strong: 0 75% 55%; /* Electric Punch - сильный акцент */
    --color-danger: 0 75% 55%;        /* Electric Punch - ошибки */
    
    /* Токены для состояний взаимодействия (hover/focus/selection) - темная тема */
    --color-hover-bg: 210 10% 18%;    /* #2A2E32 - легкий slate-blue оттенок для hover фона */
    --color-hover-border: 210 12% 45%; /* #5A6B7A - slate-blue для hover границ */
    --color-active-bg: 210 10% 20%;   /* #2F3438 - более заметный slate-blue для active */
    --color-active-border: 210 12% 40%; /* #4F5D6A - затемненный slate-blue для active */
    --color-focus-ring: 210 12% 55%;  /* #6B7F8F - slate-blue для focus ring */
    --color-selection-bg: 210 12% 35%; /* #45505A - читаемый slate-blue для выделения текста */
    --color-selection-text: 0 0% 96%; /* Off-White - контрастный текст на selection */
    
    /* Fintage цвета для темной темы */
    --fintage-charcoal: 0 0% 6%;
    --fintage-graphite: 0 0% 16%;
    --fintage-offwhite: 0 0% 96%;
    --fintage-greige: 210 12% 55%;    /* Slate-Blue #6B7F8F - urban vintage вместо greige */
    --fintage-steel: 210 12% 55%;     /* Slate-Blue - технический urban акцент */
    --fintage-punch: 0 75% 55%;
    
    /* Совместимость - старый sand теперь slate-blue */
    --fintage-sand: 210 12% 55%;      /* Slate-Blue вместо Accent Sand */
    
    /* Винтажные цвета для темной темы (совместимость) */
    --vintage-cream: 0 0% 6%;
    --vintage-beige: 0 0% 16%;
    --vintage-black: 0 0% 6%;
    --vintage-gray: 0 0% 60%;
    --vintage-gold: 200 15% 60%;     /* Cold Steel Light вместо золотого */
    --vintage-brown: 0 0% 16%;
    
    /* Токены отступов для темной темы (те же значения) */
    --space-xs: 0.5rem;
    --space-sm: 1rem;
    --space-md: 2rem;
    --space-lg: 3rem;
    --space-xl: 4rem;
    
    /* Токены прозрачности для темной темы (те же значения) */
    --opacity-low: 0.2;
    --opacity-mid: 0.5;
    --opacity-high: 0.8;
    
    /* Тени для темной темы - минимальные, но выразительные */
    --fintage-shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.5), 0 1px 2px rgba(0, 0, 0, 0.3);
    --fintage-shadow-md: 0 2px 8px rgba(0, 0, 0, 0.6), 0 1px 3px rgba(0, 0, 0, 0.4);
    --fintage-shadow-elevated: 0 4px 16px rgba(0, 0, 0, 0.5), 0 2px 4px rgba(0, 0, 0, 0.3);
    
    /* Винтажные тени (совместимость) */
    --vintage-shadow-sm: var(--fintage-shadow-sm);
    --vintage-shadow-md: var(--fintage-shadow-md);
    --vintage-shadow-lg: var(--fintage-shadow-md);
    --vintage-shadow-vintage: var(--fintage-shadow-md);
    
    /* Совместимость */
    --roseBeige: 0 0% 8%;
    --mistGray: 0 0% 20%;
    --linenWhite: 0 0% 12%;
    --sageTint: 45 15% 95%;
    --inkSoft: 45 15% 95%;
    --soft-shadow: var(--vintage-shadow-sm);
    --medium-shadow: var(--vintage-shadow-md);
    --warm-shadow: var(--vintage-shadow-vintage);
    --breathing-shadow: var(--vintage-shadow-md);
  }
}

@layer base {
  * {
    border-color: hsl(var(--border));
  }
  body {
    @apply bg-fintage-offwhite dark:bg-fintage-charcoal font-sans;
    font-family: var(--font-body), -apple-system, BlinkMacSystemFont, "Helvetica Neue", "Arial", sans-serif;
    font-size: 16px;
    font-weight: 400;
    line-height: 1.8; /* Большая межстрочность - fashion эстетика */
    color: hsl(var(--foreground)) !important;
    letter-spacing: -0.01em;
  }
  
  /* Принудительное переопределение цвета для body в темной теме */
  .dark body {
    color: hsl(var(--foreground)) !important;
  }
  
  /* Плавный переход при смене темы - slow fade 220-350ms */
  * {
    transition: 
      background-color 0.28s cubic-bezier(0.4, 0, 0.2, 1),
      color 0.28s cubic-bezier(0.4, 0, 0.2, 1),
      border-color 0.28s cubic-bezier(0.4, 0, 0.2, 1),
      opacity 0.28s cubic-bezier(0.4, 0, 0.2, 1),
      transform 0.28s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  /* Исключения для анимаций */
  .anim-breath,
  .anim-float,
  .rb-flower,
  .anim-breath-slow,
  .anim-float-slow,
  .rb-bloom-in {
    transition: none; /* Анимации не должны прерываться */
  }
  
  h1, h2, h3, h4, h5, h6 {
    font-family: var(--font-display), "Cormorant Garamond", serif;
    font-weight: 600;
    letter-spacing: -0.03em; /* Уверенная типографика */
    color: hsl(var(--foreground));
    line-height: 1.2; /* Больше воздуха для fashion эстетики */
  }
  
  /* Адаптивные line-height для заголовков - улучшает читаемость на мобильных */
  h1 {
    line-height: clamp(1.1, 1.2vw + 0.95, 0.95);
  }
  
  h2 {
    line-height: clamp(1.15, 1.1vw + 1.0, 1.0);
  }
  
  h3 {
    line-height: clamp(1.2, 1.0vw + 1.05, 1.05);
  }
  
  /* Явное переопределение цвета для всех текстовых элементов в темной теме */
  .dark {
    color: hsl(var(--foreground)) !important;
  }
  
  /* Переопределение для всех дочерних элементов - принудительно убираем синий */
  /* Исключаем кнопки, ссылки, их дочерние элементы и элементы с явно заданным цветом через классы Tailwind */
  .dark *:not([class*="text-"]):not(svg):not(path):not(circle):not(rect):not(line):not(polygon):not(button):not(a):not(button *):not(a *) {
    color: hsl(var(--foreground)) !important;
  }
  
  /* Исключения для элементов с явно заданным цветом через классы Tailwind */
  /* Для кнопок и ссылок используем более специфичное правило */
  .dark [class*="text-"]:not(button):not(a) {
    color: inherit !important;
  }
  
  /* SVG элементы не должны менять цвет */
  .dark svg,
  .dark svg * {
    color: inherit !important;
  }
  
  /* Ссылки без классов - наследуют цвет */
  /* Исключаем ссылки с явно заданным цветом через Tailwind классы */
  .dark a:not([class*="text-"]):not([class*="dark:text-"]):not([class*="dark:!text-"]) {
    color: hsl(var(--foreground)) !important;
  }
  
  /* Кнопки без классов - наследуют цвет текста */
  /* Исключаем кнопки с явно заданным цветом через Tailwind классы */
  .dark button:not([class*="text-"]):not([class*="dark:text-"]):not([class*="dark:!text-"]),
  .dark a[class*="button"]:not([class*="text-"]):not([class*="dark:text-"]):not([class*="dark:!text-"]) {
    color: hsl(var(--foreground)) !important;
  }
  
  /* Специфичное правило для primary кнопок в темной теме - принудительно применяем Charcoal цвет */
  /* Primary кнопки в темной теме имеют bg-fintage-offwhite и должны иметь text-fintage-charcoal */
  /* Это правило должно иметь максимальную специфичность и применяться после всех остальных */
  .dark button[class*="bg-fintage-offwhite"],
  .dark a[class*="bg-fintage-offwhite"],
  .dark button[class*="dark:bg-fintage-offwhite"],
  .dark a[class*="dark:bg-fintage-offwhite"],
  .dark button.dark\:bg-fintage-offwhite,
  .dark a.dark\:bg-fintage-offwhite {
    color: hsl(var(--fintage-charcoal)) !important;
  }
  
  /* Также для hover и active состояний primary кнопок */
  .dark button[class*="bg-fintage-offwhite"]:hover,
  .dark a[class*="bg-fintage-offwhite"]:hover,
  .dark button[class*="dark:bg-fintage-offwhite"]:hover,
  .dark a[class*="dark:bg-fintage-offwhite"]:hover,
  .dark button.dark\:bg-fintage-offwhite:hover,
  .dark a.dark\:bg-fintage-offwhite:hover,
  .dark button[class*="bg-fintage-offwhite"]:active,
  .dark a[class*="bg-fintage-offwhite"]:active,
  .dark button[class*="dark:bg-fintage-offwhite"]:active,
  .dark a[class*="dark:bg-fintage-offwhite"]:active,
  .dark button.dark\:bg-fintage-offwhite:active,
  .dark a.dark\:bg-fintage-offwhite:active {
    color: hsl(var(--fintage-charcoal)) !important;
  }
  
  /* Принудительно применяем цвет для кнопок и ссылок с явно заданным цветом через dark:text- */
  /* Исключаем primary кнопки, которые обрабатываются выше и ниже */
  .dark button[class*="text-"]:not([class*="bg-fintage-offwhite"]):not([class*="dark:bg-fintage-offwhite"]):not([class*="dark:!text-fintage-charcoal"]):not([class*="dark:text-fintage-charcoal"]),
  .dark button[class*="dark:text-"]:not([class*="bg-fintage-offwhite"]):not([class*="dark:bg-fintage-offwhite"]):not([class*="dark:!text-fintage-charcoal"]):not([class*="dark:text-fintage-charcoal"]),
  .dark a[class*="text-"]:not([class*="bg-fintage-offwhite"]):not([class*="dark:bg-fintage-offwhite"]):not([class*="dark:!text-fintage-charcoal"]):not([class*="dark:text-fintage-charcoal"]),
  .dark a[class*="dark:text-"]:not([class*="bg-fintage-offwhite"]):not([class*="dark:bg-fintage-offwhite"]):not([class*="dark:!text-fintage-charcoal"]):not([class*="dark:text-fintage-charcoal"]),
  .dark a[class*="button"][class*="text-"]:not([class*="bg-fintage-offwhite"]):not([class*="dark:bg-fintage-offwhite"]):not([class*="dark:!text-fintage-charcoal"]):not([class*="dark:text-fintage-charcoal"]) {
    color: inherit !important;
  }
  
  /* Специфичное правило для кнопок с темным фоном и светлым текстом в темной теме */
  /* Кнопки с bg-fintage-charcoal должны иметь text-fintage-offwhite */
  .dark button[class*="bg-fintage-charcoal"]:not([class*="bg-fintage-offwhite"]),
  .dark a[class*="bg-fintage-charcoal"]:not([class*="bg-fintage-offwhite"]),
  .dark button[class*="dark:bg-fintage-charcoal"]:not([class*="bg-fintage-offwhite"]),
  .dark a[class*="dark:bg-fintage-charcoal"]:not([class*="bg-fintage-offwhite"]) {
    color: hsl(var(--fintage-offwhite)) !important;
  }
  
  /* Также для hover и active состояний кнопок с темным фоном */
  .dark button[class*="bg-fintage-charcoal"]:not([class*="bg-fintage-offwhite"]):hover,
  .dark a[class*="bg-fintage-charcoal"]:not([class*="bg-fintage-offwhite"]):hover,
  .dark button[class*="dark:bg-fintage-charcoal"]:not([class*="bg-fintage-offwhite"]):hover,
  .dark a[class*="dark:bg-fintage-charcoal"]:not([class*="bg-fintage-offwhite"]):hover,
  .dark button[class*="bg-fintage-charcoal"]:not([class*="bg-fintage-offwhite"]):active,
  .dark a[class*="bg-fintage-charcoal"]:not([class*="bg-fintage-offwhite"]):active,
  .dark button[class*="dark:bg-fintage-charcoal"]:not([class*="bg-fintage-offwhite"]):active,
  .dark a[class*="dark:bg-fintage-charcoal"]:not([class*="bg-fintage-offwhite"]):active {
    color: hsl(var(--fintage-offwhite)) !important;
  }
  
  /* Правило для кнопок с явно заданным dark:text-fintage-offwhite */
  .dark button[class*="dark:text-fintage-offwhite"],
  .dark button[class*="dark:!text-fintage-offwhite"],
  .dark a[class*="dark:text-fintage-offwhite"],
  .dark a[class*="dark:!text-fintage-offwhite"] {
    color: hsl(var(--fintage-offwhite)) !important;
  }
  
  /* КРИТИЧНО: Правило для primary кнопок с dark:!text-fintage-charcoal */
  /* Primary кнопки должны иметь темный текст на светлом фоне в темной теме */
  .dark button[class*="dark:!text-fintage-charcoal"],
  .dark button[class*="dark:text-fintage-charcoal"],
  .dark a[class*="dark:!text-fintage-charcoal"],
  .dark a[class*="dark:text-fintage-charcoal"],
  .dark button.dark\:\!text-fintage-charcoal,
  .dark a.dark\:\!text-fintage-charcoal {
    color: hsl(var(--fintage-charcoal)) !important;
  }
  
  /* Также для hover и active состояний */
  .dark button[class*="dark:!text-fintage-charcoal"]:hover,
  .dark button[class*="dark:text-fintage-charcoal"]:hover,
  .dark a[class*="dark:!text-fintage-charcoal"]:hover,
  .dark a[class*="dark:text-fintage-charcoal"]:hover,
  .dark button[class*="dark:!text-fintage-charcoal"]:active,
  .dark button[class*="dark:text-fintage-charcoal"]:active,
  .dark a[class*="dark:!text-fintage-charcoal"]:active,
  .dark a[class*="dark:text-fintage-charcoal"]:active {
    color: hsl(var(--fintage-charcoal)) !important;
  }
  
  /* ФИНАЛЬНОЕ ПРАВИЛО: Максимальная специфичность для primary кнопок */
  /* Комбинированный селектор для кнопок с bg-fintage-offwhite И dark:!text-fintage-charcoal */
  .dark button[class*="bg-fintage-offwhite"][class*="dark:!text-fintage-charcoal"],
  .dark a[class*="bg-fintage-offwhite"][class*="dark:!text-fintage-charcoal"],
  .dark button[class*="dark:bg-fintage-offwhite"][class*="dark:!text-fintage-charcoal"],
  .dark a[class*="dark:bg-fintage-offwhite"][class*="dark:!text-fintage-charcoal"],
  .dark button.dark\:bg-fintage-offwhite[class*="dark:!text-fintage-charcoal"],
  .dark a.dark\:bg-fintage-offwhite[class*="dark:!text-fintage-charcoal"] {
    color: hsl(var(--fintage-charcoal)) !important;
  }
  
  /* Также для hover и active */
  .dark button[class*="bg-fintage-offwhite"][class*="dark:!text-fintage-charcoal"]:hover,
  .dark a[class*="bg-fintage-offwhite"][class*="dark:!text-fintage-charcoal"]:hover,
  .dark button[class*="dark:bg-fintage-offwhite"][class*="dark:!text-fintage-charcoal"]:hover,
  .dark a[class*="dark:bg-fintage-offwhite"][class*="dark:!text-fintage-charcoal"]:hover,
  .dark button[class*="bg-fintage-offwhite"][class*="dark:!text-fintage-charcoal"]:active,
  .dark a[class*="bg-fintage-offwhite"][class*="dark:!text-fintage-charcoal"]:active,
  .dark button[class*="dark:bg-fintage-offwhite"][class*="dark:!text-fintage-charcoal"]:active,
  .dark a[class*="dark:bg-fintage-offwhite"][class*="dark:!text-fintage-charcoal"]:active {
    color: hsl(var(--fintage-charcoal)) !important;
  }
  
  /* КРИТИЧНО: Правило для span и других дочерних элементов внутри primary кнопок */
  /* Дочерние элементы должны иметь явный цвет charcoal */
  .dark button[class*="bg-fintage-offwhite"][class*="dark:!text-fintage-charcoal"] *,
  .dark a[class*="bg-fintage-offwhite"][class*="dark:!text-fintage-charcoal"] *,
  .dark button[class*="dark:bg-fintage-offwhite"][class*="dark:!text-fintage-charcoal"] *,
  .dark a[class*="dark:bg-fintage-offwhite"][class*="dark:!text-fintage-charcoal"] *,
  .dark button[class*="bg-fintage-offwhite"][class*="dark:!text-fintage-charcoal"] span,
  .dark a[class*="bg-fintage-offwhite"][class*="dark:!text-fintage-charcoal"] span,
  .dark button[class*="dark:bg-fintage-offwhite"][class*="dark:!text-fintage-charcoal"] span,
  .dark a[class*="dark:bg-fintage-offwhite"][class*="dark:!text-fintage-charcoal"] span {
    color: hsl(var(--fintage-charcoal)) !important;
  }
  
  /* Также для кнопок с dark:!text-fintage-charcoal без bg-fintage-offwhite в селекторе */
  .dark button[class*="dark:!text-fintage-charcoal"] *,
  .dark a[class*="dark:!text-fintage-charcoal"] *,
  .dark button[class*="dark:!text-fintage-charcoal"] span,
  .dark a[class*="dark:!text-fintage-charcoal"] span {
    color: hsl(var(--fintage-charcoal)) !important;
  }
  
  /* Переопределение для всех текстовых элементов */
  .dark p,
  .dark span:not([class*="text-"]),
  .dark div:not([class*="text-"]),
  .dark h1:not([class*="text-"]),
  .dark h2:not([class*="text-"]),
  .dark h3:not([class*="text-"]),
  .dark h4:not([class*="text-"]),
  .dark h5:not([class*="text-"]),
  .dark h6:not([class*="text-"]),
  .dark li,
  .dark td,
  .dark th {
    color: hsl(var(--foreground)) !important;
  }
  
  /* КРИТИЧНО: Исключаем span внутри primary кнопок из правила выше */
  /* Span внутри primary кнопок должны наследовать цвет от кнопки (charcoal) */
  /* Это правило должно идти ПОСЛЕ правила для всех span, чтобы переопределить его */
  .dark button[class*="bg-fintage-offwhite"] span,
  .dark a[class*="bg-fintage-offwhite"] span,
  .dark button[class*="dark:bg-fintage-offwhite"] span,
  .dark a[class*="dark:bg-fintage-offwhite"] span,
  .dark button[class*="dark:!text-fintage-charcoal"] span,
  .dark a[class*="dark:!text-fintage-charcoal"] span,
  .dark button[class*="bg-fintage-offwhite"][class*="dark:!text-fintage-charcoal"] span,
  .dark a[class*="bg-fintage-offwhite"][class*="dark:!text-fintage-charcoal"] span,
  .dark button[class*="dark:bg-fintage-offwhite"][class*="dark:!text-fintage-charcoal"] span,
  .dark a[class*="dark:bg-fintage-offwhite"][class*="dark:!text-fintage-charcoal"] span {
    color: hsl(var(--fintage-charcoal)) !important;
  }

  /* Form controls: Fintage focus and autofill reset */
  input, textarea, select {
    accent-color: hsl(var(--color-accent));
    caret-color: hsl(var(--fintage-charcoal));
    background-color: hsl(var(--background)) !important; /* жёстко фиксируем фон */
    color: hsl(var(--foreground));
  }
  
  /* Переопределение для темной темы */
  .dark input,
  .dark textarea,
  .dark select {
    accent-color: hsl(var(--color-accent));
    caret-color: hsl(var(--fintage-offwhite));
    background-color: hsl(var(--fintage-charcoal)) !important;
    color: hsl(var(--fintage-offwhite)) !important;
  }
  
  /* Стили для option элементов в темной теме */
  .dark select option {
    background-color: hsl(var(--fintage-charcoal)) !important;
    color: hsl(var(--fintage-offwhite)) !important;
  }
  input:focus,
  input:focus-visible,
  textarea:focus,
  textarea:focus-visible,
  select:focus,
  select:focus-visible {
    outline: none !important;
    border-color: hsl(var(--color-focus-ring)) !important;
    /* Мягкий фокус с greige акцентом - контраст 3:1+ */
    box-shadow: 0 0 0 2px hsl(var(--color-focus-ring) / 0.25) !important;
  }
  
  /* Focus для темной темы */
  .dark input:focus,
  .dark input:focus-visible,
  .dark textarea:focus,
  .dark textarea:focus-visible,
  .dark select:focus,
  .dark select:focus-visible {
    border-color: hsl(var(--color-focus-ring)) !important;
    box-shadow: 0 0 0 2px hsl(var(--color-focus-ring) / 0.25) !important;
  }
  
}

/* ===== RB: Autofill + Focus hard reset ===== */
:root {
  --rb-autofill-bg: hsl(var(--background));
  /* синхронизация нативных контролов с темой */
  --rb-color-scheme: light;
}

.dark {
  --rb-color-scheme: dark;
}

@layer utilities {
  /* Убираем синий tap-highlight на мобильных Safari/Chrome */
  html :is(a, button, input, textarea, select) {
    -webkit-tap-highlight-color: transparent;
  }

  /* Глобальная подсветка выделенного текста - используем greige акцент */
  ::selection {
    background: hsl(var(--color-selection-bg));
    color: hsl(var(--color-selection-text));
  }
  ::-moz-selection {
    background: hsl(var(--color-selection-bg));
    color: hsl(var(--color-selection-text));
  }
  
  /* Fintage подсветка выделенного текста внутри input/textarea */
  html input::selection,
  html textarea::selection {
    background: hsl(var(--color-selection-bg));
    color: hsl(var(--color-selection-text));
  }
  html input::-moz-selection,
  html textarea::-moz-selection {
    background: hsl(var(--color-selection-bg));
    color: hsl(var(--color-selection-text));
  }

  /* Windows High Contrast / Edge forced-colors — только для наших полей */
  @media (forced-colors: active) {
    html :is(input[data-rb-input], textarea[data-rb-input], select[data-rb-input]) {
      forced-color-adjust: none;
      outline: 0 !important;
      border-color: hsl(var(--input)) !important;
      background-color: Canvas !important; /* системный фон темы, убирает синий */
      color: CanvasText !important;        /* системный цвет текста */
      box-shadow:
        0 0 0 2px var(--tw-ring-color, transparent),
        0 0 0 var(--tw-ring-offset-width, 0) var(--tw-ring-offset-color, transparent) !important;
    }
  }

  /* Страховка от остаточного UA outline/glow */
  html :is(input, textarea, select):focus,
  html :is(input, textarea, select):focus-visible {
    outline: 0 !important;
  }
  /* Chrome/Safari (WebKit) */
  html input:-webkit-autofill,
  html input:-webkit-autofill:hover,
  html input:-webkit-autofill:focus,
  html textarea:-webkit-autofill,
  html textarea:-webkit-autofill:hover,
  html textarea:-webkit-autofill:focus,
  html select:-webkit-autofill,
  html select:-webkit-autofill:hover,
  html select:-webkit-autofill:focus {
    -webkit-text-fill-color: hsl(var(--foreground)) !important;
    caret-color: hsl(var(--foreground)) !important;
    -webkit-box-shadow: 0 0 0 1000px var(--rb-autofill-bg) inset !important;
    box-shadow: 0 0 0 1000px var(--rb-autofill-bg) inset !important;
    -webkit-background-clip: padding-box !important;
    border-radius: inherit !important;
    transition: background-color 99999s ease-out 0s !important;
  }

  /* Адресный таргет с повышенной специфичностью */
  html input[data-rb-input]:-webkit-autofill,
  html textarea[data-rb-input]:-webkit-autofill,
  html select[data-rb-input]:-webkit-autofill {
    -webkit-text-fill-color: hsl(var(--foreground)) !important;
    caret-color: hsl(var(--foreground)) !important;
    -webkit-box-shadow: 0 0 0 1000px var(--rb-autofill-bg) inset !important;
    box-shadow: 0 0 0 1000px var(--rb-autofill-bg) inset !important;
    -webkit-background-clip: padding-box !important;
    border-radius: inherit !important;
  }

  /* Стандартный псевдокласс */
  html :is(input, textarea, select):autofill,
  html :is(input[data-rb-input], textarea[data-rb-input], select[data-rb-input]):autofill {
    -webkit-text-fill-color: hsl(var(--foreground)) !important;
    caret-color: hsl(var(--foreground)) !important;
    -webkit-box-shadow: 0 0 0 1000px var(--rb-autofill-bg) inset !important;
    box-shadow: 0 0 0 1000px var(--rb-autofill-bg) inset !important;
  }

  /* Firefox */
  html input:-moz-autofill,
  html textarea:-moz-autofill,
  html select:-moz-autofill {
    color: hsl(var(--foreground)) !important;
    box-shadow: 0 0 0 1000px var(--rb-autofill-bg) inset !important;
  }

  /* Убираем нативный синий outline, не трогая наш ring */
  html :is(input, textarea, select):focus,
  html :is(input, textarea, select):focus-visible {
    outline: 0 !important;
  }

  /* Стабилизируем рендер форм-контролов */
  input, textarea, select {
    -webkit-appearance: none;
    appearance: none;
    color-scheme: var(--rb-color-scheme);
  }

  /* Прячем синий contacts-autofill значок в Safari */
  input::-webkit-contacts-auto-fill-button {
    visibility: hidden;
    display: none !important;
    pointer-events: none;
  }

  /* Запасной канал: если браузер/менеджер паролей не даёт :-webkit-autofill,
     но значение уже вставлено — используем data-атрибут */
  input[data-autocompleted],
  textarea[data-autocompleted],
  select[data-autocompleted] {
    -webkit-text-fill-color: hsl(var(--foreground)) !important;
    caret-color: hsl(var(--foreground)) !important;
    -webkit-box-shadow: 0 0 0 1000px var(--rb-autofill-bg) inset !important;
    box-shadow: 0 0 0 1000px var(--rb-autofill-bg) inset !important;
    -webkit-background-clip: padding-box !important;
    border-radius: inherit !important;
  }
}

@layer utilities {
  .shadow-soft {
    box-shadow: var(--soft-shadow);
  }
  
  .shadow-medium {
    box-shadow: var(--medium-shadow);
  }
  
  .shadow-warm {
    box-shadow: var(--warm-shadow);
  }
  
  .shadow-breathing {
    box-shadow: var(--breathing-shadow);
  }
  
  .text-balance {
    text-wrap: balance;
  }
  
  .bg-texture {
    background-image: 
      radial-gradient(circle at 20% 80%, rgba(244, 239, 232, 0.1) 0%, transparent 50%),
      radial-gradient(circle at 80% 20%, rgba(214, 211, 206, 0.1) 0%, transparent 50%),
      radial-gradient(circle at 40% 40%, rgba(174, 182, 175, 0.05) 0%, transparent 50%);
  }
  
  .bg-linen {
    background-image: 
      radial-gradient(circle at 30% 70%, rgba(244, 239, 232, 0.2) 0%, transparent 60%),
      radial-gradient(circle at 70% 30%, rgba(214, 211, 206, 0.15) 0%, transparent 60%);
  }
  
  /* Винтажная типографика с оригинальными шрифтами */
  .text-vintage {
    font-family: var(--font-vintage), "Cormorant Garamond", serif;
    letter-spacing: -0.01em;
    font-weight: 400;
  }
  
  .text-display-vintage {
    font-family: var(--font-display), "Cormorant Garamond", serif;
    letter-spacing: -0.03em;
    font-weight: 700;
    text-transform: uppercase;
  }
  
  .text-graceful {
    font-family: var(--font-display), "Cormorant Garamond", serif;
    letter-spacing: -0.02em;
    font-weight: 500;
  }
  
  /* Fintage система зернистости - утилиты согласно дизайн-документу (3-6% для light, до 8% для dark) */
  .grain-light {
    position: relative;
  }
  .grain-light::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image: 
      url("data:image/svg+xml,%3Csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='grain-light'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4'/%3E%3C/filter%3E%3Crect width='100' height='100' filter='url(%23grain-light)' opacity='0.03'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 1;
  }
  
  .grain-medium {
    position: relative;
  }
  .grain-medium::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image: 
      url("data:image/svg+xml,%3Csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='grain-medium'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4'/%3E%3C/filter%3E%3Crect width='100' height='100' filter='url(%23grain-medium)' opacity='0.05'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 1;
  }
  
  .grain-strong {
    position: relative;
  }
  .grain-strong::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image: 
      url("data:image/svg+xml,%3Csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='grain-strong'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4'/%3E%3C/filter%3E%3Crect width='100' height='100' filter='url(%23grain-strong)' opacity='0.06'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 1;
  }
  
  /* Fintage текстуры с зернистостью */
  .bg-fintage-grain {
    position: relative;
  }
  .bg-fintage-grain::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image: 
      url("data:image/svg+xml,%3Csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='fintage-noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4'/%3E%3C/filter%3E%3Crect width='100' height='100' filter='url(%23fintage-noise)' opacity='0.03'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 1;
  }
  
  .bg-vintage-paper {
    background-image: 
      repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0, 0, 0, 0.015) 2px, rgba(0, 0, 0, 0.015) 4px);
    background-color: hsl(var(--fintage-offwhite));
    position: relative;
  }
  .bg-vintage-paper::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image: 
      url("data:image/svg+xml,%3Csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='paper-noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4'/%3E%3C/filter%3E%3Crect width='100' height='100' filter='url(%23paper-noise)' opacity='0.02'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 1;
  }
  
  .bg-vintage-canvas {
    background-color: hsl(var(--fintage-offwhite));
    position: relative;
  }
  .bg-vintage-canvas::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image: 
      url("data:image/svg+xml,%3Csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='canvas-noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4'/%3E%3C/filter%3E%3Crect width='100' height='100' filter='url(%23canvas-noise)' opacity='0.03'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 1;
  }
  
  /* Зернистость для темной темы - до 8% согласно дизайн-системе */
  .dark .grain-light::before {
    opacity: 0.04; /* 4% для light в dark theme */
  }
  .dark .grain-medium::before {
    opacity: 0.06; /* 6% для medium в dark theme */
  }
  .dark .grain-strong::before {
    opacity: 0.08; /* 8% для strong в dark theme */
  }
  .dark .bg-vintage-paper::before,
  .dark .bg-vintage-canvas::before {
    opacity: 0.05; /* 5% для текстур в dark theme */
  }
  
  /* Винтажные границы */
  .border-vintage {
    border: 1px solid hsl(var(--vintage-beige));
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.1);
  }
  
  /* Винтажные тени */
  .shadow-vintage {
    box-shadow: var(--vintage-shadow-vintage);
  }
  
  .shadow-vintage-sm {
    box-shadow: var(--vintage-shadow-sm);
  }
  
  .shadow-vintage-md {
    box-shadow: var(--vintage-shadow-md);
  }
  
  .shadow-vintage-lg {
    box-shadow: var(--vintage-shadow-lg);
  }
  
  /* Fintage тени */
  .shadow-fintage-sm {
    box-shadow: var(--fintage-shadow-sm);
  }
  
  .shadow-fintage-md {
    box-shadow: var(--fintage-shadow-md);
  }
  
  .shadow-fintage-elevated {
    box-shadow: var(--fintage-shadow-elevated);
  }
  
  .backdrop-breathing {
    backdrop-filter: blur(6px);
    background: rgba(250, 249, 247, 0.6);
  }
  
  /* Оптимизация backdrop-filter для мобильных устройств */
  @media (max-width: 768px) {
    .backdrop-breathing {
      backdrop-filter: blur(4px);  /* Меньше размытие для лучшей производительности */
    }
  }
  
  /* Backdrop для темной темы */
  .dark .backdrop-breathing {
    backdrop-filter: blur(12px);
    background: rgba(26, 24, 21, 0.7);  /* Deep Earth с прозрачностью */
  }
  
  /* Оптимизация для темной темы на мобильных */
  @media (max-width: 768px) {
    .dark .backdrop-breathing {
      backdrop-filter: blur(6px);  /* Уменьшено размытие для производительности */
    }
  }
  
  .transition-breathing {
    transition: all 0.8s cubic-bezier(0.22, 1, 0.36, 1);
  }
  
  /* Fintage анимации - улучшенная плавность 280-300ms */
  .transition-fintage {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  .transition-fintage-slow {
    transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  /* Быстрая анимация для микро-взаимодействий */
  .transition-fintage-fast {
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  /* Fade анимации */
  .fade-in {
    animation: fintage-fade-in 0.28s cubic-bezier(0.4, 0, 0.2, 1) both;
  }
  
  .fade-in-slow {
    animation: fintage-fade-in 0.35s cubic-bezier(0.4, 0, 0.2, 1) both;
  }
  
  @keyframes fintage-fade-in {
    from {
      opacity: 0;
      transform: translateY(8px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  /* Scale-in 1.01 для hover - fashion-эстетика (улучшенная плавность) */
  .hover-scale-fintage {
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    will-change: transform;
  }
  .hover-scale-fintage:hover {
    transform: scale(1.01);
  }
  
  /* Тонкий hover эффект для карточек - повышение контраста (улучшенная плавность) */
  .hover-contrast-fintage {
    transition: filter 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }
  .hover-contrast-fintage:hover {
    filter: contrast(1.05) brightness(0.98);
  }
  
  /* Hover эффект для текста - тонкое изменение цвета на accent (улучшенная плавность) */
  .hover-text-greige {
    transition: color 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }
  .hover-text-greige:hover {
    color: hsl(var(--color-accent));
  }
  
  /* Совместимость - старый класс */
  .hover-text-steel {
    transition: color 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }
  .hover-text-steel:hover {
    color: hsl(var(--color-accent));
  }
  
  /* Плавное появление элементов - улучшенная версия */
  @keyframes fintage-fade-in-smooth {
    from {
      opacity: 0;
      transform: translateY(4px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .fade-in-smooth {
    animation: fintage-fade-in-smooth 0.3s cubic-bezier(0.4, 0, 0.2, 1) both;
  }
  
  .bg-misty {
    background-image: 
      radial-gradient(circle at 25% 75%, rgba(244, 239, 232, 0.3) 0%, transparent 50%),
      radial-gradient(circle at 75% 25%, rgba(214, 211, 206, 0.2) 0%, transparent 50%);
  }
  
  /* Фоновые текстуры для темной темы */
  .dark .bg-texture {
    background-image: 
      radial-gradient(circle at 20% 80%, rgba(143, 166, 143, 0.08) 0%, transparent 50%),
      radial-gradient(circle at 80% 20%, rgba(58, 56, 52, 0.12) 0%, transparent 50%),
      radial-gradient(circle at 40% 40%, rgba(42, 39, 35, 0.1) 0%, transparent 50%);
  }
  
  .dark .bg-linen {
    background-image: 
      radial-gradient(circle at 30% 70%, rgba(143, 166, 143, 0.1) 0%, transparent 60%),
      radial-gradient(circle at 70% 30%, rgba(58, 56, 52, 0.15) 0%, transparent 60%);
  }
  
  .dark .bg-misty {
    background-image: 
      radial-gradient(circle at 25% 75%, rgba(143, 166, 143, 0.12) 0%, transparent 50%),
      radial-gradient(circle at 75% 25%, rgba(58, 56, 52, 0.18) 0%, transparent 50%);
  }
  
  .text-whisper {
    color: hsl(var(--fintage-graphite) / 0.7); /* Улучшенная контрастность */
  }
  
  /* Text Whisper для темной темы */
  .dark .text-whisper {
    color: hsl(var(--fintage-graphite) / 0.7);  /* Улучшенная контрастность для темной темы */
  }
  
  .shadow-misty {
    box-shadow: 0 8px 32px hsl(var(--fintage-steel) / 0.12);
  }
  
  .backdrop-misty {
    backdrop-filter: blur(8px);
    background: rgba(250, 249, 247, 0.7);
  }
  
  /* Оптимизация backdrop-misty для мобильных */
  @media (max-width: 768px) {
    .backdrop-misty {
      backdrop-filter: blur(4px);  /* Меньше размытие для производительности */
    }
  }
  
  /* Backdrop misty для темной темы */
  .dark .backdrop-misty {
    backdrop-filter: blur(16px);
    background: rgba(26, 24, 21, 0.8);  /* Более непрозрачный */
  }
  
  /* Оптимизация для темной темы на мобильных */
  @media (max-width: 768px) {
    .dark .backdrop-misty {
      backdrop-filter: blur(8px);  /* Уменьшено размытие для производительности */
    }
  }
  
  /* Shadow misty для темной темы */
  .dark .shadow-misty {
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
  }
  
  /* Halo эффект для темной темы - Cold Steel */
  .dark .halo {
    background: radial-gradient(
      closest-side,
      hsl(var(--fintage-steel) / 0.15),      /* Cold Steel Glow */
      hsl(var(--fintage-steel) / 0.08) 60%,  /* Приглушенное свечение */
      transparent 70%
    );
  }
  
  /* Veil Bottom для темной темы */
  .dark .veil-bottom {
    background: linear-gradient(
      to top, 
      rgba(255, 255, 255, 0.04),      /* Легкое белое свечение */
      rgba(255, 255, 255, 0)
    );
  }
  
  /* use anim-breath */
  /* .breathing-glow {
    animation: breathing-glow 6s ease-in-out infinite;
  } */
  
  /* --- rosebotanique: motion tokens & utilities --- */
  .anim-breath { 
    animation: rb-breath 12s cubic-bezier(0.22, 1, 0.36, 1) infinite; 
    will-change: transform, opacity;
  }
  .anim-breath-slow { 
    animation: rb-breath-slow 22s ease-in-out infinite; 
    will-change: transform, opacity;
  }
  .anim-delay-2s { animation-delay: 2s; }
  
  /* Typography utilities */
  .smallcaps { 
    letter-spacing: .12em; 
    text-transform: uppercase; 
    font-weight: 500; 
  }
  
  /* Tilt effect */
  .rb-tilt { 
    transform: perspective(600px) rotateX(var(--tiltY,0deg)) rotateY(var(--tiltX,0deg)) translate3d(var(--tx,0),var(--ty,0),0); 
    will-change: transform; 
  }
  
  /* Stroke reveal animation */
  .stroke-reveal { 
    stroke-dasharray: 600; 
    stroke-dashoffset: 600; 
    transition: stroke-dashoffset 2s cubic-bezier(0.22,1,0.36,1); 
  }
  [data-inview="true"] .stroke-reveal { 
    stroke-dashoffset: 0; 
  }
  
  /* Hover mask */
  .mask-stitch { 
    opacity: 0; 
    transition: opacity 600ms cubic-bezier(0.22,1,0.36,1); 
    pointer-events: none; 
  }
  .group:hover .mask-stitch { 
    opacity: .55; 
  }
  .anim-delay-4s { animation-delay: 4s; }
  .anim-float { 
    animation: rb-float 22s ease-in-out infinite; 
  }
.anim-stitch-once { 
  animation: rb-stitch 2.7s cubic-bezier(0.22, 1, 0.36, 1) both 1; 
}

.anim-float-slow { 
  animation: rb-float-slow 18s ease-in-out infinite; 
}

  .rb-bloom-in { 
    animation: rb-bloom-in 1.2s cubic-bezier(0.22, 1, 0.36, 1) both; 
  }
  
  /* уважение к reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .anim-breath, .anim-breath-slow, .anim-float { animation: none !important; }
    .anim-stitch-once { animation-duration: 0.01s; }
  }
}

/* --- rosebotanique · Elven Flower --- */
.rb-flower { 
  --fl-dur: 900ms; 
  --fl-ease: cubic-bezier(0.22,1,0.36,1);
  animation: rb-breathe 4s ease-in-out infinite;
  transition: transform var(--fl-dur) var(--fl-ease);
}
.rb-flower svg { display:block; }

/* общее увеличение цветка при наведении */
.group:hover .rb-flower,
.group:focus-within .rb-flower { transform: scale(1.25); }

/* лепесток: лёгкий поворот и масштаб → раскрываться к 0deg/1 */
.rb-petal {
  transform-box: fill-box;
  transform-origin: 50% 50%;
  transform: rotate(-8deg) scale(.88);
  transition:
    transform var(--fl-dur) var(--fl-ease),
    opacity var(--fl-dur) var(--fl-ease);
  transition-delay: var(--d, 0ms);
}
.rb-petal path{
  stroke-dasharray: 140;
  stroke-dashoffset: 0; /* видимые контуры в покое */
  transition: stroke-dashoffset var(--fl-dur) var(--fl-ease);
  opacity:.5;
}

/* hover/focus раскрывает лепестки полностью */
.group:hover .rb-petal,
.group:focus-within .rb-petal { transform: rotate(0deg) scale(1.2); }
.group:hover .rb-petal path,
.group:focus-within .rb-petal path { stroke-dashoffset: 0; opacity:.75; }

/* сердцевина: мягко «собирается» */
.rb-core{
  transition: transform var(--fl-dur) var(--fl-ease), opacity var(--fl-dur) var(--fl-ease);
  transform: scale(.85);
  opacity:.55;
}
.group:hover .rb-core,
.group:focus-within .rb-core { transform: scale(1.2); opacity:.9; }

/* уважение к reduced motion */
@media (prefers-reduced-motion: reduce){
  .anim-breath, .anim-breath-slow, .anim-float { animation: none !important; }
  .anim-float-slow, .rb-bloom-in { animation: none !important; }
  .rb-flower { animation: none !important; }
  .anim-stitch-once { animation-duration: 0.01s; }
  .rb-petal{ transition: opacity 200ms ease; transform: none !important; }
  .rb-petal path{ transition: opacity 200ms ease; stroke-dashoffset: 0; }
  .rb-core{ transition: opacity 200ms ease; transform: none !important; }
  .stroke-reveal { stroke-dashoffset: 0 !important; }
}

/* Keyframes вне @layer для правильной работы */
@keyframes rb-breath {
  0%,100% { transform: scale(1); opacity: 0.12; }
  50%     { transform: scale(1.03); opacity: 0.20; }
}

@keyframes rb-float {
  0%,100% { transform: translateY(0) rotate(0deg); }
  50%     { transform: translateY(-8px) rotate(0.5deg); }
}

@keyframes rb-stitch {
  0%   { stroke-dashoffset: 120%; }
  100% { stroke-dashoffset: 0%; }
}

@keyframes rb-float-slow {
  0%,100% { transform: translateY(0) rotate(0deg); }
  50%     { transform: translateY(-4px) rotate(0.3deg); }
}

@keyframes rb-bloom-in {
  0%   { transform: scale(.8); opacity: 0; }
  100% { transform: scale(1); opacity: 1; }
}

@keyframes rb-breathe {
  0%,100% { transform: scale(1); opacity: 0.6; }
  50%     { transform: scale(1.05); opacity: 0.8; }
}

@keyframes rb-breath-slow {
  0%,100% { transform: scale(1); opacity: .12; }
  50%     { transform: scale(1.02); opacity: .2; }
}

/* Skeleton shimmer анимация согласно дизайн-системе */
@keyframes shimmer {
  0% {
    background-position: -200% 0;
  }
  100% {
    background-position: 200% 0;
  }
}

@keyframes rb-crossfade { 
  0%, 40%   { opacity: 1 }
  50%, 90%  { opacity: 0 }
  100%      { opacity: 1 }
}

/* Тонкое мерцание звезд */
@keyframes star-twinkle {
  0%, 100% { 
    opacity: 1;
    filter: brightness(1);
  }
  50% { 
    opacity: 0.85;
    filter: brightness(0.9);
  }
}
.rb-crossfade { position: absolute; inset: 0; object-fit: cover; opacity: 0; }
.rb-crossfade--top { animation: rb-crossfade 22s cubic-bezier(0.22,1,0.36,1) infinite; }
.group:hover .rb-crossfade--top,
.group:focus-within .rb-crossfade--top { animation-play-state: paused; }
@media (prefers-reduced-motion: reduce){
  .rb-crossfade--top { animation: none !important; opacity: 0 !important; }
}

/* koru spiral */
.rb-koru svg{display:block}
.koru-stroke{
  stroke-dasharray:600; stroke-dashoffset:0;
  transition:stroke-dashoffset 2.1s cubic-bezier(0.22,1,0.36,1);
  opacity:.75;
}
.koru-leaf{
  transform-box: fill-box; transform-origin:50% 50%;
  transition: transform 900ms cubic-bezier(0.22,1,0.36,1), opacity 900ms cubic-bezier(0.22,1,0.36,1);
}
.koru-breath{ animation: rb-koru-breath 22s ease-in-out infinite }
@keyframes rb-koru-breath{
  0%,100%{ transform: scale(1); opacity:.14 }
  50%{ transform: scale(1.02); opacity:.20 }
}
/* hover/focus раскрытие */
.koru-host:hover .koru-stroke,
.koru-host:focus-within .koru-stroke{ stroke-dashoffset:0 }
.koru-host:hover .koru-leaf,
.koru-host:focus-within .koru-leaf{ transform: rotate(0deg) scale(1.02); opacity:.7 }
/* respect reduced motion */
@media (prefers-reduced-motion: reduce){
  .koru-breath{ animation:none!important }
  .koru-stroke{ transition:none; stroke-dashoffset:0 }
  .koru-leaf{ transition: opacity 200ms ease; transform:none!important }
}

/* --- NOAH stitched label --- */
.noah-wrap {
  display: inline-flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
}

.noah-stitch {
  display:block;
}
.noah-stitch-path{
  stroke:#aeb6af;
  stroke-width:1.25;
  stroke-linecap:round;
  fill:none;
  stroke-dasharray: 240;
  stroke-dashoffset: 240;
  transition: stroke-dashoffset 1.6s cubic-bezier(0.22,1,0.36,1);
  opacity:.35;
}

/* линия под словом для выравнивания, можно отключить */
.noah-line{
  line-height:1;
}

.noah-word{
  font-family: var(--font-body, Inter), ui-sans-serif, system-ui, -apple-system;
  font-size: 12px;
  letter-spacing: .18em;           /* стартовый kerning */
  text-transform: uppercase;
  color: rgba(75,75,75,.72);       /* inkSoft/72% */
  opacity: 0;
  transform: translateY(2px);
  transition:
    opacity 420ms cubic-bezier(0.22,1,0.36,1),
    transform 420ms cubic-bezier(0.22,1,0.36,1),
    letter-spacing 300ms cubic-bezier(0.22,1,0.36,1);
}

/* триггер: hover/focus на кнопку CTA */
.about-hover:has(.cta-link:hover) .noah-stitch-path,
.about-hover:has(.cta-link:focus) .noah-stitch-path{
  stroke-dashoffset: 0;
  opacity:.45;
}
.about-hover:has(.cta-link:hover) .noah-word,
.about-hover:has(.cta-link:focus) .noah-word{
  opacity:.9;
  transform: translateY(0);
  letter-spacing: .22em;           /* лёгкое расширение */
}

/* reduced-motion: показать сразу, без анимации */
@media (prefers-reduced-motion: reduce){
  .noah-stitch-path{
    transition:none; stroke-dashoffset:0; opacity:.45;
  }
  .noah-word{
    transition:none; opacity:.9; transform:none; letter-spacing:.22em;
  }
}

/* мобильное поведение (опционально):
   делаем слово видно сразу, чтобы не зависеть от hover */
@media (max-width: 767.98px){
  .noah-word{ opacity:.9; transform:none; }
  .noah-stitch-path{ stroke-dashoffset:0; }
}

/* Saturn Planet */
.rb-nord-disc svg{display:block}
.rb-nord-disc{ 
  opacity: 0.6; /* более заметный */
  perspective: 1000px;
}
.nord-disc-breath{
  transform-style: preserve-3d;
}

/* Дыхание планеты */
.saturn-planet {
  animation: rb-saturn-pulse 24s ease-in-out infinite;
}
@keyframes rb-saturn-pulse{ 
  0%,100%{ transform: scale(1); opacity: 1; }
  50%{ transform: scale(1.08); opacity: 1; }
}

/* Медленное вращение колец */
.saturn-rings-front {
  animation: rb-saturn-rings-rotate 120s linear infinite;
  transform-origin: center;
}
.saturn-rings-back {
  animation: rb-saturn-rings-rotate 140s linear infinite;
  transform-origin: center;
}
@keyframes rb-saturn-rings-rotate{
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

/* Дыхание всего контейнера + наклон из стороны в сторону */
.nord-disc-breath{ 
  animation: rb-disc-breath 22s cubic-bezier(0.22,1,0.36,1) infinite;
}
@keyframes rb-disc-breath{ 
  0%,100%{ transform: scale(1) rotateX(0deg) rotateY(-20deg); }
  25%{ transform: scale(1.01) rotateX(0deg) rotateY(-18deg); }
  50%{ transform: scale(1.02) rotateX(0deg) rotateY(-22deg); }
  75%{ transform: scale(1.01) rotateX(0deg) rotateY(-18deg); }
}

/* Ripple при hover текстовой колонки */
.about-hover:hover .rb-nord-disc,
.about-hover:focus-within .rb-nord-disc{ 
  opacity: .8; 
  transform: scale(1.12);
  transition: opacity 600ms ease-out, transform 600ms ease-out;
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce){ 
  .nord-disc-breath{ animation: none !important; }
  .saturn-planet{ animation: none !important; }
  .saturn-rings-front{ animation: none !important; }
  .saturn-rings-back{ animation: none !important; }
}

/* Nordic Branch - чистая реализация */
.rb-nordic-branch svg { 
  display: block;
}

.nord-host {
  cursor: pointer;
}

.nord-stem {
  stroke: #aeb6af; 
  stroke-width: 1.4; 
  fill: none; 
  stroke-linecap: round;
  opacity: .8;
}

/* листья: старт из маленького размера */
.nord-leaf {
  transform-box: fill-box;
  transform-origin: center bottom;
  transform: rotate(var(--r,0deg)) scaleY(0.25);
  opacity: .35;
  transition: transform 600ms cubic-bezier(0.34, 1.56, 0.64, 1), opacity 600ms ease-out;
  transition-delay: var(--d, 0ms);
}

/* рост листьев при hover */
.nord-host:hover .nord-stem {
  stroke: #8a9a8a;
  opacity: 1;
}

.nord-host:hover .nord-leaf {
  transform: rotate(var(--r,0deg)) scaleY(1);
  opacity: .75;
}

/* едва заметное покачивание */
.nord-sway { 
  animation: rb-nord-sway 20s ease-in-out infinite;
}

@keyframes rb-nord-sway {
  0%, 100% { transform: rotate(0deg) }
  50% { transform: rotate(0.5deg) }
}

/* reduced motion */
@media (prefers-reduced-motion: reduce) {
  .nord-sway { animation: none !important }
  .nord-leaf { transition: opacity 200ms ease; transform: rotate(var(--r,0deg)) scaleY(0.7); opacity: .6 }
}

/* use anim-breath */
/* @keyframes breathing-glow {
  0%,100% { transform: scale(1); opacity: 0.3; }
  50%     { transform: scale(1.1); opacity: 0.6; }
} */

/* едва заметный дрейф для центра (чуть тише стандартного) */
@keyframes rb-float-slow {
  0%,100% { transform: translateY(0) }
  50%     { transform: translateY(-4px) }
}
.anim-float-slow { animation: rb-float-slow 24s ease-in-out infinite; }

/* мягкий вход цветка (скейл/прозрачность) */
@keyframes rb-bloom-in {
  0%   { transform: scale(.92); opacity: 0 }
  100% { transform: scale(1);   opacity: 1 }
}
.rb-bloom-in { animation: rb-bloom-in 600ms cubic-bezier(0.22,1,0.36,1) both; }

/* autofill detection helper */
@keyframes rb-autofill-start { from { opacity: 1 } to { opacity: 1 } }
input:-webkit-autofill {
  animation-name: rb-autofill-start;
  animation-duration: 0.01s;
}

/* ============================================
   StarField - Реалистичное звездное небо для темной темы
   ============================================ */

/* Контейнер звезд - только в темной теме */
.stars-container {
  opacity: 0;
  transition: opacity 0.8s ease-in-out;
}

.dark .stars-container {
  opacity: 1;
}

/* Базовые стили для звезд - статичные, без анимации */
.stars {
  position: absolute;
  width: 1px;
  height: 1px;
  background: transparent;
  border-radius: 50%;
  /* Убрана анимация - звезды статичны */
}

/* Яркие звезды (самые заметные) - с тонким мерцанием */
.stars-bright {
  width: 2px;
  height: 2px;
  animation: star-twinkle 8s ease-in-out infinite;
  animation-delay: var(--twinkle-delay, 0s);
}

/* Большие звезды - с тонким мерцанием */
.stars-large {
  width: 1.5px;
  height: 1.5px;
  animation: star-twinkle 10s ease-in-out infinite;
  animation-delay: var(--twinkle-delay, 0s);
}

/* Средние звезды - с тонким мерцанием */
.stars-medium {
  width: 1.2px;
  height: 1.2px;
  animation: star-twinkle 12s ease-in-out infinite;
  animation-delay: var(--twinkle-delay, 0s);
}

/* Маленькие звезды - без мерцания для производительности */
.stars-small {
  width: 1px;
  height: 1px;
}

/* Очень маленькие звезды - без мерцания для производительности */
.stars-tiny {
  width: 0.7px;
  height: 0.7px;
}

/* Отключаем мерцание на мобильных для производительности */
@media (max-width: 768px) {
  .stars-bright,
  .stars-large,
  .stars-medium {
    animation: none;
  }
}

/* Уважение к reduced motion */
@media (prefers-reduced-motion: reduce) {
  .stars-bright,
  .stars-large,
  .stars-medium {
    animation: none !important;
  }
}

/* Скрытие скроллбара */
.scrollbar-hide {
  -ms-overflow-style: none;  /* IE и Edge */
  scrollbar-width: none;  /* Firefox */
}

.scrollbar-hide::-webkit-scrollbar {
  display: none;  /* Chrome, Safari и Opera */
}

/* Утилитный класс для шрифта логотипа - прямая проверка */
.font-logo {
  font-family: 'Modern No. 20', var(--font-logo), serif !important;
}

