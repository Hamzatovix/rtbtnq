#!/bin/bash
# –í—Ä–µ–º–µ–Ω–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ SSL –¥–ª—è rosebotanique.store
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

set -e

echo "üîß –í—Ä–µ–º–µ–Ω–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ SSL –¥–ª—è rosebotanique.store"
echo "=================================================="
echo ""

NGINX_CONF="/root/Shtraf/nginx/nginx.conf"
BACKUP_FILE="/root/Shtraf/nginx/nginx.conf.backup-$(date +%Y%m%d-%H%M%S)"

# –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è
echo "1Ô∏è‚É£  –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏..."
cp "$NGINX_CONF" "$BACKUP_FILE"
echo "‚úÖ –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è: $BACKUP_FILE"
echo ""

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
echo "2Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏..."
if grep -q "ssl_certificate.*rosebotanique.store.crt" "$NGINX_CONF"; then
    echo "‚ö†Ô∏è  –ù–∞–π–¥–µ–Ω—ã SSL –¥–∏—Ä–µ–∫—Ç–∏–≤—ã –¥–ª—è rosebotanique.store"
else
    echo "‚úÖ SSL –¥–∏—Ä–µ–∫—Ç–∏–≤—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã (—É–∂–µ –æ—Ç–∫–ª—é—á–µ–Ω—ã?)"
fi
echo ""

echo "üìù –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:"
echo "=============="
echo ""
echo "–ù—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª: $NGINX_CONF"
echo ""
echo "1. –ù–∞–π—Ç–∏ –±–ª–æ–∫ '# --- Rosebotanique.store HTTPS ---'"
echo "2. –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å—å –±–ª–æ–∫ (–¥–æ–±–∞–≤–∏—Ç—å # –≤ –Ω–∞—á–∞–ª–æ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏)"
echo "3. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ HTTP –±–ª–æ–∫ –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –Ω–∞ http://rosebotanique:3000"
echo ""
echo "–ò–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã:"
echo ""
echo "sed -i '/# --- Rosebotanique.store HTTPS ---/,/^}/s/^/#/' $NGINX_CONF"
echo ""
echo "–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ë–ï–ó SSL volumes –¥–ª—è rosebotanique"
echo ""

