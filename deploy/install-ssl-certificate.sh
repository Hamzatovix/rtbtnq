#!/bin/bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –¥–ª—è rosebotanique.store

set -e

echo "üîê –£—Å—Ç–∞–Ω–æ–≤–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –¥–ª—è rosebotanique.store"
echo "==================================================="
echo ""

CERT_DIR="/root/Shtraf/nginx/ssl/rosebotanique"
CERT_FILE="$CERT_DIR/certificate.crt"
KEY_FILE="$CERT_DIR/certificate.key"
NGINX_CONF="/root/Shtraf/nginx/nginx.conf"
BACKUP_FILE="/root/Shtraf/nginx/nginx.conf.backup-ssl-$(date +%Y%m%d-%H%M%S)"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
if [ ! -d "$CERT_DIR" ]; then
    echo "üìÅ –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤..."
    mkdir -p "$CERT_DIR"
    chmod 755 "$CERT_DIR"
fi

echo "üìù –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞:"
echo "======================================="
echo ""
echo "–£ —Ç–µ–±—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 3 —Ñ–∞–π–ª–∞:"
echo "  1. –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (Certificate) - –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å '-----BEGIN CERTIFICATE-----'"
echo "  2. –ö–æ—Ä–Ω–µ–≤–æ–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (Root Certificate) - –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å '-----BEGIN CERTIFICATE-----'"
echo "  3. –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á (Private Key) - —É–∂–µ –µ—Å—Ç—å –≤ $KEY_FILE"
echo ""
echo "–®–∞–≥ 1: –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç"
echo "--------------------------------------"
echo "–í—ã–ø–æ–ª–Ω–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:"
echo "  nano $CERT_FILE"
echo ""
echo "–£–¥–∞–ª–∏ –≤—Å—ë —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏ –≤—Å—Ç–∞–≤—å –û–°–ù–û–í–ù–û–ô —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (Certificate)"
echo "–û–Ω –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å: -----BEGIN CERTIFICATE-----"
echo "–ò –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–∞: -----END CERTIFICATE-----"
echo ""
echo "–°–æ—Ö—Ä–∞–Ω–∏: Ctrl+O, Enter, Ctrl+X"
echo ""
echo ""
echo "–®–∞–≥ 2: –î–æ–±–∞–≤–∏—Ç—å –∫–æ—Ä–Ω–µ–≤–æ–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (–µ—Å–ª–∏ –µ—Å—Ç—å)"
echo "-----------------------------------------------"
echo "–ï—Å–ª–∏ —É —Ç–µ–±—è –µ—Å—Ç—å –∫–æ—Ä–Ω–µ–≤–æ–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (Root Certificate),"
echo "–¥–æ–±–∞–≤—å –µ–≥–æ –í –ö–û–ù–ï–¶ —Ñ–∞–π–ª–∞ certificate.crt:"
echo ""
echo "  nano $CERT_FILE"
echo ""
echo "–ü–æ—Å–ª–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –¥–æ–±–∞–≤—å –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –∏ –≤—Å—Ç–∞–≤—å –∫–æ—Ä–Ω–µ–≤–æ–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç"
echo "–§–∞–π–ª –¥–æ–ª–∂–µ–Ω –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:"
echo ""
echo "-----BEGIN CERTIFICATE-----"
echo "[–æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç]"
echo "-----END CERTIFICATE-----"
echo ""
echo "-----BEGIN CERTIFICATE-----"
echo "[–∫–æ—Ä–Ω–µ–≤–æ–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç]"
echo "-----END CERTIFICATE-----"
echo ""
echo "–°–æ—Ö—Ä–∞–Ω–∏: Ctrl+O, Enter, Ctrl+X"
echo ""
echo ""
echo "–®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞"
echo "-----------------------------------"
echo "–ü–æ—Å–ª–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–∏:"
echo ""
echo "  head -5 $CERT_FILE"
echo "  grep 'BEGIN CERTIFICATE' $CERT_FILE"
echo "  openssl x509 -in $CERT_FILE -text -noout | head -10"
echo ""
echo "–ï—Å–ª–∏ –∫–æ–º–∞–Ω–¥–∞ openssl —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫ - —Ñ–æ—Ä–º–∞—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π!"
echo ""
echo ""
echo "–®–∞–≥ 4: –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Nginx"
echo "----------------------------------"
echo "–í—ã–ø–æ–ª–Ω–∏ —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:"
echo "  bash deploy/update-nginx-for-ssl.sh"
echo ""
echo "–ò–ª–∏ –≤—Ä—É—á–Ω—É—é:"
echo "  1. –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å SSL –¥–∏—Ä–µ–∫—Ç–∏–≤—ã –≤ nginx.conf"
echo "  2. –ò–∑–º–µ–Ω–∏—Ç—å HTTP –±–ª–æ–∫ –Ω–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç"
echo ""
echo ""
echo "–®–∞–≥ 5: –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä"
echo "---------------------------"
echo "  bash deploy/recreate-nginx-with-ssl.sh"
echo ""
echo ""
echo "üí° –°–æ–≤–µ—Ç: –ï—Å–ª–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ .pem –∏–ª–∏ .cer,"
echo "   –ø—Ä–æ—Å—Ç–æ —Å–∫–æ–ø–∏—Ä—É–π –µ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤ certificate.crt"
echo ""

