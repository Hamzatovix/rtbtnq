#!/bin/bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞

set -e

echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –∏ –∫–ª—é—á–∞"
echo "============================================="
echo ""

CERT_FILE="/root/Shtraf/nginx/ssl/rosebotanique/certificate.crt"
KEY_FILE="/root/Shtraf/nginx/ssl/rosebotanique/certificate.key"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤
if [ ! -f "$CERT_FILE" ]; then
    echo "‚ùå –§–∞–π–ª —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω: $CERT_FILE"
    exit 1
fi

if [ ! -f "$KEY_FILE" ]; then
    echo "‚ùå –§–∞–π–ª –∫–ª—é—á–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω: $KEY_FILE"
    exit 1
fi

echo "1Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞..."
if openssl x509 -in "$CERT_FILE" -noout -text > /dev/null 2>&1; then
    echo "‚úÖ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ"
    CERT_MODULUS=$(openssl x509 -in "$CERT_FILE" -noout -modulus 2>/dev/null | openssl md5)
    echo "   –ú–æ–¥—É–ª—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞: $CERT_MODULUS"
else
    echo "‚ùå –û—à–∏–±–∫–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞!"
    exit 1
fi
echo ""

echo "2Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –∫–ª—é—á–∞..."
if openssl rsa -in "$KEY_FILE" -noout -check > /dev/null 2>&1; then
    echo "‚úÖ –ö–ª—é—á –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ"
    KEY_MODULUS=$(openssl rsa -in "$KEY_FILE" -noout -modulus 2>/dev/null | openssl md5)
    echo "   –ú–æ–¥—É–ª—å –∫–ª—é—á–∞: $KEY_MODULUS"
else
    echo "‚ùå –û—à–∏–±–∫–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –∫–ª—é—á–∞!"
    exit 1
fi
echo ""

echo "3Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è..."
if [ "$CERT_MODULUS" = "$KEY_MODULUS" ]; then
    echo "‚úÖ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∏ –∫–ª—é—á —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –¥—Ä—É–≥ –¥—Ä—É–≥—É!"
else
    echo "‚ùå –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∏ –∫–ª—é—á –ù–ï —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç!"
    echo ""
    echo "üí° –ü—Ä–æ–±–ª–µ–º–∞:"
    echo "   –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—É."
    echo ""
    echo "üîß –†–µ—à–µ–Ω–∏–µ:"
    echo "   1. –£–±–µ–¥–∏—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á"
    echo "   2. –ö–ª—é—á –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–µ–º –∂–µ, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è CSR"
    echo "   3. –ü—Ä–æ–≤–µ—Ä—å —Ñ–∞–π–ª rosebotanique.store.key –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ"
    echo ""
    echo "üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ:"
    echo "   openssl x509 -noout -modulus -in certificate.crt | openssl md5"
    echo "   openssl rsa -noout -modulus -in rosebotanique.store.key | openssl md5"
    echo "   –≠—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å!"
fi


