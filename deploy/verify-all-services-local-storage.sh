#!/bin/bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ

set -e

echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è"
echo "============================================="
echo ""

# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
echo "1Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è Supabase..."
if docker exec rosebotanique env | grep -q "^SUPABASE_URL="; then
    echo "‚ùå –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ Supabase –≤—Å—ë –µ—â—ë –∞–∫—Ç–∏–≤–Ω—ã!"
    docker exec rosebotanique env | grep "^SUPABASE"
    exit 1
else
    echo "‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ Supabase –æ—Ç–∫–ª—é—á–µ–Ω—ã"
fi
echo ""

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥ —Å–µ—Ä–≤–∏—Å–æ–≤
echo "2Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ —Å–µ—Ä–≤–∏—Å–æ–≤..."
echo ""

echo "üì¶ –¢–æ–≤–∞—Ä—ã (products):"
echo "   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç products-json.service.ts"
echo "   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç isSupabaseEnabled()"
echo "   - –ï—Å–ª–∏ Supabase –æ—Ç–∫–ª—é—á–µ–Ω ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ ‚úÖ"
echo ""

echo "üì¶ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ (categories):"
echo "   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç categories-json.service.ts"
echo "   - –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Supabase –≤–æ–æ–±—â–µ ‚úÖ"
echo "   - –¢–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ (categories.json)"
echo ""

echo "üì¶ –¶–≤–µ—Ç–∞ (colors):"
echo "   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç colors-json.service.ts"
echo "   - –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Supabase –≤–æ–æ–±—â–µ ‚úÖ"
echo "   - –¢–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ (colors.json)"
echo ""

echo "üì¶ –ì–∞–ª–µ—Ä–µ—è (gallery):"
echo "   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç gallery-json.service.ts"
echo "   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç isSupabaseEnabled()"
echo "   - –ï—Å–ª–∏ Supabase –æ—Ç–∫–ª—é—á–µ–Ω ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ ‚úÖ"
echo ""

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º
echo "3Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º –¥–∞–Ω–Ω—ã—Ö..."
FILES=(
    "/app/src/data/products.json"
    "/app/src/data/categories.json"
    "/app/src/data/colors.json"
    "/app/src/data/gallery.json"
)

for file in "${FILES[@]}"; do
    if docker exec rosebotanique test -w "$file" 2>/dev/null; then
        echo "‚úÖ –î–æ—Å—Ç—É–ø –Ω–∞ –∑–∞–ø–∏—Å—å: $file"
    else
        echo "‚ùå –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ –∑–∞–ø–∏—Å—å: $file"
        docker exec rosebotanique ls -la "$file" 2>/dev/null || echo "   –§–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
    fi
done
echo ""

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫ Supabase
echo "4Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –Ω–∞ –æ—à–∏–±–∫–∏ Supabase..."
if docker logs rosebotanique --tail 50 2>&1 | grep -q "Supabase"; then
    echo "‚ö†Ô∏è  –ù–∞–π–¥–µ–Ω—ã —É–ø–æ–º–∏–Ω–∞–Ω–∏—è Supabase –≤ –ª–æ–≥–∞—Ö:"
    docker logs rosebotanique --tail 50 2>&1 | grep -i "supabase" | head -5
else
    echo "‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ Supabase –≤ –ª–æ–≥–∞—Ö"
fi
echo ""

echo "üéâ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
echo ""
echo "üìã –†–µ–∑—é–º–µ:"
echo "   ‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ Supabase –æ—Ç–∫–ª—é—á–µ–Ω—ã"
echo "   ‚úÖ –¢–æ–≤–∞—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ (–µ—Å–ª–∏ Supabase –æ—Ç–∫–ª—é—á–µ–Ω)"
echo "   ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ"
echo "   ‚úÖ –¶–≤–µ—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ"
echo "   ‚úÖ –ì–∞–ª–µ—Ä–µ—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ (–µ—Å–ª–∏ Supabase –æ—Ç–∫–ª—é—á–µ–Ω)"
echo ""
echo "üí° –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π!"


